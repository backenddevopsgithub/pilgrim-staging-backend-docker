<VirtualHost *:80>

    ServerName pilgrimconnect.co.uk
    ServerAlias *.ngrok.io
    ServerAdmin webmaster@localhost

    DocumentRoot /var/www/laravel/public/

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <Directory /var/www/laravel/public/>
        DirectoryIndex index.html index.php
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        Order allow,deny
        Allow from all
    </Directory>

    RewriteEngine on
    RewriteCond %{SERVER_NAME} =pilgrimconnect.co.uk [OR]
    RewriteCond %{SERVER_NAME} =*.ngrok.io
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]

    # CUSTOM
#    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [END,NE,R=permanent]

</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost _default_:443>
        ServerName pilgrimconnect.co.uk
        ServerAlias *.ngrok.io
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/laravel/public/
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
        <Directory /var/www/laravel/public/>
            DirectoryIndex index.html index.php
            Options Indexes FollowSymLinks
            AllowOverride All
            Require all granted
            Order allow,deny
            Allow from all
        </Directory>

        SSLCertificateFile /etc/letsencrypt/live/pilgrimconnect.co.uk/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/pilgrimconnect.co.uk/privkey.pem
        Include /etc/letsencrypt/options-ssl-apache.conf

    </VirtualHost>
</IfModule>
